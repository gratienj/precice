<?xml version="1.0" encoding="UTF-8" ?>
<precice-configuration>
  <solver-interface>
    <data:scalar name="Stretch1" />
    <data:scalar name="Stretch2" />
    <data:scalar name="Activation1" />
    <data:scalar name="Activation2" />
    <data:scalar name="Traction" />
    <data:scalar name="Displacement" />

    <mesh name="Surface_Mesh1">
      <use-data name="Traction" />
      <use-data name="Displacement" />
    </mesh>

    <mesh name="Surface_Mesh2">
      <use-data name="Traction" />
      <use-data name="Displacement" />
    </mesh>

    <mesh name="Activation_M1_Mesh">
      <use-data name="Activation1" />
    </mesh>

    <mesh name="Activation_M1SM_Mesh">
      <use-data name="Activation1" />
    </mesh>

    <mesh name="Activation_M2_Mesh">
      <use-data name="Activation2" />
    </mesh>

    <mesh name="Activation_M2SM_Mesh">
      <use-data name="Activation2" />
    </mesh>

    <mesh name="Stretch_M1_Mesh">
      <use-data name="Stretch1" />
    </mesh>

    <mesh name="Stretch_M1SM_Mesh">
      <use-data name="Stretch1" />
    </mesh>

    <mesh name="Stretch_M2_Mesh">
      <use-data name="Stretch2" />
    </mesh>

    <mesh name="Stretch_M2SM_Mesh">
      <use-data name="Stretch2" />
    </mesh>

    <mesh name="Stretch_M2_Cross_Mesh">
      <use-data name="Stretch1" />
    </mesh>

    <mesh name="Stretch_M1_Cross_Mesh">
      <use-data name="Stretch2" />
    </mesh>

    <participant name="M1SM">
      <provide-mesh name="Surface_Mesh1" />
      <receive-mesh name="Surface_Mesh2" from="M2SM" />
      <mapping:nearest-neighbor
        direction="write"
        from="Surface_Mesh1"
        to="Surface_Mesh2"
        constraint="consistent" />
      <mapping:nearest-neighbor
        direction="read"
        from="Surface_Mesh2"
        to="Surface_Mesh1"
        constraint="consistent" />
      <provide-mesh name="Activation_M1SM_Mesh" />
      <provide-mesh name="Stretch_M1SM_Mesh" />
      <read-data name="Activation1" mesh="Activation_M1SM_Mesh" />
      <write-data name="Stretch1" mesh="Stretch_M1SM_Mesh" />
      <write-data name="Displacement" mesh="Surface_Mesh1" />
      <read-data name="Traction" mesh="Surface_Mesh1" />
    </participant>

    <participant name="M2SM">
      <provide-mesh name="Surface_Mesh2" />
      <provide-mesh name="Activation_M2SM_Mesh" />
      <provide-mesh name="Stretch_M2SM_Mesh" />
      <read-data name="Activation2" mesh="Activation_M2SM_Mesh" />
      <write-data name="Stretch2" mesh="Stretch_M2SM_Mesh" />
      <write-data name="Traction" mesh="Surface_Mesh2" />
      <read-data name="Displacement" mesh="Surface_Mesh2" />
    </participant>

    <participant name="M1">
      <provide-mesh name="Activation_M1_Mesh" />
      <receive-mesh name="Activation_M1SM_Mesh" from="M1SM" />
      <mapping:nearest-neighbor
        direction="write"
        from="Activation_M1_Mesh"
        to="Activation_M1SM_Mesh"
        constraint="consistent" />
      <provide-mesh name="Stretch_M1_Mesh" />
      <provide-mesh name="Stretch_M1_Cross_Mesh" />
      <receive-mesh name="Stretch_M1SM_Mesh" from="M1SM" />
      <mapping:nearest-neighbor
        direction="read"
        to="Stretch_M1_Mesh"
        from="Stretch_M1SM_Mesh"
        constraint="consistent" />
      <receive-mesh name="Stretch_M2SM_Mesh" from="M2SM" />
      <mapping:nearest-neighbor
        direction="read"
        from="Stretch_M2SM_Mesh"
        to="Stretch_M1_Cross_Mesh"
        constraint="consistent" />
      <read-data name="Stretch1" mesh="Stretch_M1_Mesh" />
      <read-data name="Stretch2" mesh="Stretch_M1_Cross_Mesh" />
      <write-data name="Activation1" mesh="Activation_M1_Mesh" />
    </participant>

    <participant name="M2">
      <provide-mesh name="Activation_M2_Mesh" />
      <receive-mesh name="Activation_M2SM_Mesh" from="M1SM" />
      <mapping:nearest-neighbor
        direction="write"
        from="Activation_M2_Mesh"
        to="Activation_M2SM_Mesh"
        constraint="consistent" />
      <provide-mesh name="Stretch_M2_Mesh" />
      <provide-mesh name="Stretch_M2_Cross_Mesh" />
      <receive-mesh name="Stretch_M2SM_Mesh" from="M2SM" />
      <mapping:nearest-neighbor
        direction="read"
        to="Stretch_M2_Mesh"
        from="Stretch_M2SM_Mesh"
        constraint="consistent" />
      <receive-mesh name="Stretch_M1SM_Mesh" from="M1SM" />
      <mapping:nearest-neighbor
        direction="read"
        from="Stretch_M1SM_Mesh"
        to="Stretch_M2_Cross_Mesh"
        constraint="consistent" />
      <read-data name="Stretch2" mesh="Stretch_M2_Mesh" />
      <read-data name="Stretch1" mesh="Stretch_M2_Cross_Mesh" />
      <write-data name="Activation2" mesh="Activation_M2_Mesh" />
    </participant>

    <m2n:sockets from="M1" to="M1SM" />
    <m2n:sockets from="M2" to="M2SM" />
    <m2n:sockets from="M1" to="M2SM" />
    <m2n:sockets from="M2" to="M1SM" />
    <m2n:sockets from="M1SM" to="M2SM" />

    <coupling-scheme:serial-explicit>
      <participants first="M1SM" second="M2" />
      <time-window-size value="1" />
      <max-time-windows value="2" />
      <exchange data="Stretch1" mesh="Stretch_M1SM_Mesh" from="M1SM" to="M2" />
    </coupling-scheme:serial-explicit>

    <coupling-scheme:serial-explicit>
      <participants first="M2SM" second="M1" />
      <time-window-size value="1" />
      <max-time-windows value="2" />
      <exchange data="Stretch2" mesh="Stretch_M2SM_Mesh" from="M2SM" to="M1" />
    </coupling-scheme:serial-explicit>

    <coupling-scheme:serial-explicit>
      <participants first="M1SM" second="M1" />
      <time-window-size value="1" />
      <max-time-windows value="2" />
      <exchange data="Stretch1" mesh="Stretch_M1SM_Mesh" from="M1SM" to="M1" />
      <exchange data="Activation1" mesh="Activation_M1SM_Mesh" from="M1" to="M1SM" />
    </coupling-scheme:serial-explicit>

    <coupling-scheme:serial-explicit>
      <participants first="M2SM" second="M2" />
      <time-window-size value="1" />
      <max-time-windows value="2" />
      <exchange data="Stretch2" mesh="Stretch_M2SM_Mesh" from="M2SM" to="M2" />
      <exchange data="Activation2" mesh="Activation_M2SM_Mesh" from="M2" to="M2SM" />
    </coupling-scheme:serial-explicit>

    <coupling-scheme:parallel-implicit>
      <participants first="M1SM" second="M2SM" />
      <time-window-size value="1" />
      <max-time-windows value="2" />
      <exchange data="Displacement" mesh="Surface_Mesh2" from="M1SM" to="M2SM" />
      <exchange data="Traction" mesh="Surface_Mesh2" from="M2SM" to="M1SM" />
      <max-iterations value="1" />
      <min-iteration-convergence-measure
        min-iterations="1"
        data="Displacement"
        mesh="Surface_Mesh2" />
    </coupling-scheme:parallel-implicit>
  </solver-interface>
</precice-configuration>
