# log2trace

# Purpose and Function

The tool __log2trace__ reads the event log files generated by multiple solvers coppled by preCICE and assembles a single tracing file.
The chromium tracing tool, built into chromium browsers (`chrome://tracing`), can read this file and produce a browsable timegraph.
The tool is also available as a [standalone](https://github.com/catapult-project/catapult/tree/master/tracing) as a part of the
[catapult project](https://github.com/catapult-project/catapult/).


# Usage

```sh
log2trace.py -p -b def A=./Events-A.log B=./Events-B.log
```

| Parameter | Description |
| --------- | ----------- |
| `-h`, `--help`   | Print the help. |
| `-p`, `--pretty` | Outputs the JSON structure in a human-friendly format. |
| `-d`, `--default`| Overwrites the default category name (`default`) for unknown events. |
| `PARTICIPANT=LOGFILE ...` | Reads a logfile by a participant. |


# Example

This section is based on the [1D Example](https://github.com/precice/precice/wiki/1D-Example).

Follow the instructions in the wiki.
After running, execute:
```sh
python3.6 log2trace.py Fluid=./Events-FLUID.log Structure=./Events-STRUCTURE.log > trace.json
```
Open your favorite chromium browser and go to `chrome://tracing`.
Load the file `trace.json`.


# Technical Details

The format of the resulting JSON is based on the given [specification](https://docs.google.com/document/d/1CvAClvFfyA5R-PhYUmn5OOQtYMH4h6I0nSsKchNAySU/preview#).

The current logging format logs the event starts and stop times.
This is equivalent to the `Duration Event` type from the specification.

The logical mapping between preCICE and the specification is:

| specification | preCICE |
| ------------- | ------- |
| processes | participants |
| threads |  ranks |

The script contains a mapping which assigns categories to events based on their name.
If an event is considered _unknown_ if there is not entry in this dictionary.
In such a case, a default class gets assigned to it.
This default is `default` and may be overwritten using the `--default` flag.
